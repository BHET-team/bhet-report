<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jill Baumgartner (Co-PI)">
<meta name="author" content="Sam Harper (Co-PI)">
<meta name="dcterms.date" content="2024-02-22">

<title>How Do Household Energy Transitions Work?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="hei-report_files/libs/clipboard/clipboard.min.js"></script>
<script src="hei-report_files/libs/quarto-html/quarto.js"></script>
<script src="hei-report_files/libs/quarto-html/popper.min.js"></script>
<script src="hei-report_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="hei-report_files/libs/quarto-html/anchor.min.js"></script>
<link href="hei-report_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="hei-report_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="hei-report_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="hei-report_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="hei-report_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#abstract" id="toc-abstract" class="nav-link active" data-scroll-target="#abstract">Abstract</a>
  <ul class="collapse">
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a></li>
  <li><a href="#conclusions" id="toc-conclusions" class="nav-link" data-scroll-target="#conclusions">Conclusions</a></li>
  </ul></li>
  <li><a href="#introduction-1" id="toc-introduction-1" class="nav-link" data-scroll-target="#introduction-1"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background"><span class="header-section-number">2</span> Background</a>
  <ul class="collapse">
  <li><a href="#context-for-the-policy" id="toc-context-for-the-policy" class="nav-link" data-scroll-target="#context-for-the-policy"><span class="header-section-number">2.1</span> Context for the policy</a></li>
  <li><a href="#prior-evidence-of-household-energy-interventions-and-air-pollution" id="toc-prior-evidence-of-household-energy-interventions-and-air-pollution" class="nav-link" data-scroll-target="#prior-evidence-of-household-energy-interventions-and-air-pollution"><span class="header-section-number">2.2</span> Prior evidence of household energy interventions and air pollution</a></li>
  <li><a href="#prior-evidence-on-clean-energy-interventions" id="toc-prior-evidence-on-clean-energy-interventions" class="nav-link" data-scroll-target="#prior-evidence-on-clean-energy-interventions"><span class="header-section-number">2.3</span> Prior evidence on clean energy interventions</a></li>
  <li><a href="#importance-of-understanding-mechanisms-through-which-policies-may-affect-outcomes." id="toc-importance-of-understanding-mechanisms-through-which-policies-may-affect-outcomes." class="nav-link" data-scroll-target="#importance-of-understanding-mechanisms-through-which-policies-may-affect-outcomes."><span class="header-section-number">2.4</span> Importance of understanding mechanisms through which policies may affect outcomes.</a></li>
  </ul></li>
  <li><a href="#specific-aims-and-overarching-approach" id="toc-specific-aims-and-overarching-approach" class="nav-link" data-scroll-target="#specific-aims-and-overarching-approach"><span class="header-section-number">3</span> Specific Aims and Overarching Approach</a></li>
  <li><a href="#study-design-and-methods" id="toc-study-design-and-methods" class="nav-link" data-scroll-target="#study-design-and-methods"><span class="header-section-number">4</span> Study Design and Methods</a>
  <ul class="collapse">
  <li><a href="#location-context-and-recruitment" id="toc-location-context-and-recruitment" class="nav-link" data-scroll-target="#location-context-and-recruitment"><span class="header-section-number">4.1</span> Location, context, and recruitment</a></li>
  <li><a href="#measures" id="toc-measures" class="nav-link" data-scroll-target="#measures"><span class="header-section-number">4.2</span> Measures</a>
  <ul class="collapse">
  <li><a href="#individual-level" id="toc-individual-level" class="nav-link" data-scroll-target="#individual-level"><span class="header-section-number">4.2.1</span> Individual level:</a></li>
  </ul></li>
  <li><a href="#policy-impacts" id="toc-policy-impacts" class="nav-link" data-scroll-target="#policy-impacts"><span class="header-section-number">4.3</span> Policy impacts</a></li>
  <li><a href="#pathways-and-mechanisms" id="toc-pathways-and-mechanisms" class="nav-link" data-scroll-target="#pathways-and-mechanisms"><span class="header-section-number">4.4</span> Pathways and mechanisms</a></li>
  </ul></li>
  <li><a href="#data-analysis" id="toc-data-analysis" class="nav-link" data-scroll-target="#data-analysis"><span class="header-section-number">5</span> Data Analysis</a>
  <ul class="collapse">
  <li><a href="#total-effect" id="toc-total-effect" class="nav-link" data-scroll-target="#total-effect"><span class="header-section-number">5.1</span> Total Effect</a></li>
  <li><a href="#mediation-analysis" id="toc-mediation-analysis" class="nav-link" data-scroll-target="#mediation-analysis"><span class="header-section-number">5.2</span> Mediation Analysis</a></li>
  </ul></li>
  <li><a href="#results-1" id="toc-results-1" class="nav-link" data-scroll-target="#results-1"><span class="header-section-number">6</span> Results</a>
  <ul class="collapse">
  <li><a href="#description-of-study-sample-table" id="toc-description-of-study-sample-table" class="nav-link" data-scroll-target="#description-of-study-sample-table"><span class="header-section-number">6.1</span> Description of study sample (Table)</a></li>
  <li><a href="#aim-1-policy-impacts-and-potential-mediation" id="toc-aim-1-policy-impacts-and-potential-mediation" class="nav-link" data-scroll-target="#aim-1-policy-impacts-and-potential-mediation"><span class="header-section-number">6.2</span> Aim 1: Policy impacts and potential mediation</a></li>
  <li><a href="#aim-2-source-contributions" id="toc-aim-2-source-contributions" class="nav-link" data-scroll-target="#aim-2-source-contributions"><span class="header-section-number">6.3</span> Aim 2: Source contributions</a></li>
  <li><a href="#aim-3" id="toc-aim-3" class="nav-link" data-scroll-target="#aim-3"><span class="header-section-number">6.4</span> Aim 3</a></li>
  </ul></li>
  <li><a href="#discussion-and-conclusions" id="toc-discussion-and-conclusions" class="nav-link" data-scroll-target="#discussion-and-conclusions"><span class="header-section-number">7</span> Discussion and Conclusions</a></li>
  <li><a href="#implications-of-findings" id="toc-implications-of-findings" class="nav-link" data-scroll-target="#implications-of-findings"><span class="header-section-number">8</span> Implications of Findings</a></li>
  <li><a href="#data-availability-statement" id="toc-data-availability-statement" class="nav-link" data-scroll-target="#data-availability-statement"><span class="header-section-number">9</span> Data Availability Statement</a></li>
  <li><a href="#acknowledgements" id="toc-acknowledgements" class="nav-link" data-scroll-target="#acknowledgements"><span class="header-section-number">10</span> Acknowledgements</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">11</span> References</a></li>
  <li><a href="#appendices" id="toc-appendices" class="nav-link" data-scroll-target="#appendices">Appendices</a></li>
  <li><a href="#about-the-authors" id="toc-about-the-authors" class="nav-link" data-scroll-target="#about-the-authors">About the authors</a></li>
  <li><a href="#other-publications" id="toc-other-publications" class="nav-link" data-scroll-target="#other-publications">Other publications</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">How Do Household Energy Transitions Work?</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Jill Baumgartner (Co-PI) </p>
             <p>Sam Harper (Co-PI) </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 22, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="abstract" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="abstract">Abstract</h2>
<section id="introduction" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="introduction">Introduction</h3>
</section>
<section id="methods" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="methods">Methods</h3>
</section>
<section id="results" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="results">Results</h3>
</section>
<section id="conclusions" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="conclusions">Conclusions</h3>
</section>
</section>
<section id="introduction-1" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>China is deploying an ambitious policy to transition up to 70% of households in northern China to clean space heating, including Beijing. To meet this target the Beijing municipal government announced a two-pronged program that designates coal-restricted areas and simultaneously offers subsidies to night-time electricity rates and for the purchase and installation of electric-powered, air-source heat pumps to replace traditional coal-heating stoves. The program is being rolled out on a village-by-village basis; however there is uncertainty as to when villages will receive the program. The variability in when the policy is applied to each village allows us to treat the roll-out of the program as a quasi-randomized intervention. Households may also be differentially affected by this program due to factors such as financial constraints, preferences and social capital, and there is uncertainty about whether and how this intervention may affect indoor and outdoor air pollution, as well as health behaviors and health outcomes.</p>
</section>
<section id="background" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Background</h1>
<section id="context-for-the-policy" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="context-for-the-policy"><span class="header-section-number">2.1</span> Context for the policy</h2>
<p>Household coal burning has been a major contributor to indoor and outdoor air pollution in northern China, especially in winter. Prior to 2016, coal fuel was used to meet over 80% of northern China’s space heating demand (ref NRDC doc). Household coal-fuelled heaters, common in peri-urban and rural areas without access to centralized heating, burned approximately half of the over 400 million tons of coal used for space heating (ref NRDC doc) and contributed to ~30% of northern China’s wintertime air pollution. [[[something on health impacts]]]</p>
<p>Replacing household coal stoves with clean heating alternatives was considered a potentially impactful intervention to reduce outdoor PM2.5 and its health impacts.</p>
<p>A number of clean heating options including electric heat pumps, gas heaters, and electric resistance heaters with thermal storage were widely promoted by the Chinese government (ref NRDC doc).</p>
<p>By 2021, over 36 million households in northern China were treated by the policy and an estimated 21 million more households were expected to be treated by 2025. Whether this large-scale energy policy yielded health benefits remains a critical and unresolved question.</p>
</section>
<section id="prior-evidence-of-household-energy-interventions-and-air-pollution" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="prior-evidence-of-household-energy-interventions-and-air-pollution"><span class="header-section-number">2.2</span> Prior evidence of household energy interventions and air pollution</h2>
<p>See <a href="https://onlinelibrary.wiley.com/doi/epdf/10.1111/ina.12958">report</a> from Woolley et al <span class="citation" data-cites="woolley2022">(<a href="#ref-woolley2022" role="doc-biblioref">Woolley et al. 2022</a>)</span></p>
</section>
<section id="prior-evidence-on-clean-energy-interventions" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="prior-evidence-on-clean-energy-interventions"><span class="header-section-number">2.3</span> Prior evidence on clean energy interventions</h2>
<p>Most previous health assessments of household energy technologies have focused on cookstoves and not heating stoves. Randomized trials of less polluting cookstoves indicate a cardiovascular benefit of clean heating energy transition. In Guatemala, a chimney stove intervention lowered exposure to air pollution and reduced the occurrence of nonspecific ST-segment depression, an indicator of health conditions including myocardial ischemia, in older women. That same study and other trials in Nigeria and Ghana observed reductions in blood pressure (range: −3.7 to −1.3mmHg) in women assigned gas, ethanol, or improved combustion biomass stoves, and are supported by non-randomized, controlled intervention studies in Nicaragua and Bolivia (blood pressure reductions ranging −5.9 to −5.5mmHg). In contrast, a recent multi-country randomized trial did not observe a protective effect of gas stoves on gestational blood pressure despite large reductions in indoor and personal exposures to PM2.5, though the participants were younger (mean age: 25y) than in studies showing a blood pressure benefit of intervention (mean ages: 28 to 53y).</p>
<p>The few previous evaluations of household energy policies, mostly in high-income countries, have also indicated some health benefit, though many did not control for secular changes in health over time. Residential wood-burning bans were associated with reductions in cardiovascular hospitalizations (-7%) in California’s San Joaquin Valley, and with reduced cardiovascular (17.9%) and respiratory (−22.8%) mortality in Launceston, Tasmania (Australia), though neither study fully controlled for secular improvements in health. Most relevant to our study are two quasi-experimental assessments of coal replacement policies. Small decreases in chronic lung diseases (-3.0 to -1.1%) were observed in a multi-city cohort of 8524 Chinese adults in cities where the coal-to-clean energy policy was piloted compared with adults in cities not included in the pilot. The study observed no change in physician-diagnosed cardiovascular diseases, potentially due to the only one-year post-policy period or confounding by other city-wide air quality and health-related policies. In a population-based study in Ireland, reductions in respiratory mortality were observed, but no effect was found for cardiovascular mortality after accounting for secular changes in health.</p>
</section>
<section id="importance-of-understanding-mechanisms-through-which-policies-may-affect-outcomes." class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="importance-of-understanding-mechanisms-through-which-policies-may-affect-outcomes."><span class="header-section-number">2.4</span> Importance of understanding mechanisms through which policies may affect outcomes.</h2>
</section>
</section>
<section id="specific-aims-and-overarching-approach" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Specific Aims and Overarching Approach</h1>
<p>This study used three data collection campaigns in winter 2018/19, winter 2019/20, and winter 2021/22, as well as a partial campaign in winter 2020/21 to advance the following aims:</p>
<ol type="1">
<li><p>Estimate how much of the policy’s overall effect on health, including respiratory symptoms and cardiovascular outcomes (blood pressure, central hemodynamics, blood inflammatory and oxidative stress markers), can be attributed to its impact on changes in PM2.5;</p></li>
<li><p>Quantify the impact of the policy on outdoor air quality and personal air pollution exposures, and specifically the source contribution from household coal burning (Previously Aim 3);</p></li>
<li><p>Quantify the contribution of changes in the chemical composition of PM2.5 from different sources to the overall effect on health outcomes (Previously Aim 2).</p></li>
</ol>
</section>
<section id="study-design-and-methods" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Study Design and Methods</h1>
<section id="location-context-and-recruitment" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="location-context-and-recruitment"><span class="header-section-number">4.1</span> Location, context, and recruitment</h2>
<p>In December 2018 we recruited 50 villages across 4 administrative divisions of peri-urban Beijing to participate in our study. Villages were selected on the basis of their residents primarily using household coal and/or biomass stoves, and because roughly half of the villages were expected to enter into the CBHP policy over the course of our study. We used local guides in each village to help determine a roster of households that were not vacant during the winter months, from which we selected households to recruit for participation.</p>
<p>We recruited approximately 20 households in each village and randomly selected one eligible person from each household to participate. Participants were eligible to participate if they were over 40 years old, lived in the study villages, were not planning to move out of the village in the next year, and were not on current immunotherapy or treatment with corticosteroids. Research staff introduced the study and its measurements to an eligible person in each household and answered any questions related to the study. All participants provided written informed consent prior to joining the study. The study protocols were approved by research ethics boards at Peking University (IRB00001052-18090) and McGill University (A08-E53-18B).</p>
</section>
<section id="measures" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="measures"><span class="header-section-number">4.2</span> Measures</h2>
<p>Village level:</p>
<ul>
<li>Outdoor air pollution</li>
<li>Qualitative and quantitative information on current policies/programs with government funding from local leaders</li>
</ul>
<p>Household level:</p>
<ul>
<li>Questionnaire to assess energy use and related expenditures</li>
<li>Indoor air temperature (~75% of homes for 2+ winter months)</li>
<li>Indoor PM2.5 in ~50% of study homes</li>
<li>Electricity use based on meters</li>
</ul>
<section id="individual-level" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="individual-level"><span class="header-section-number">4.2.1</span> Individual level:</h3>
<p><strong>Questionnaires on health status, behaviors, and medication</strong></p>
<p><strong>Personal exposures to PM2.5 and black carbon (50% of participants)</strong><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>To measure personal exposure we used two types of samplers: Personal Exposure Monitors (PEMs, Apex Pro; Casella, UK) and Ultrasonic Personal Aerosol Samplers (UPAS, Access Sensor Technologies, Fort Collins, CO, USA). PEMs actively sampled at a flow rate of 1.8 L/min, and UPAS was at 1.0 L/min <span class="citation" data-cites="volckens2017">(<a href="#ref-volckens2017" role="doc-biblioref">Volckens et al. 2017</a>)</span>. Both samplers housed 37 mm PTFE filters (VWR, 2.0-μm pore size) and were equipped with a cyclone inlet with a 2.5 μm cutpoint. Sampler flow rates were calibrated the night before deployment and also measured after the sampling period. Few post-sampling measurements (16 out of 494, 3%) deviated from the target flow rate by &gt;10%. Participants were instructed to wear a small waistpack (for the PEM and sampling pump) or an arm bag (for the UPAS) for 24 hours, which they could place within 2 meters while sleeping, sitting, or bathing. Field blanks were collected at a rate of ~10% in each village. All filters were placed in individually labeled Petri dishes, sealed in plastic bags, and then transported to a field laboratory and immediately stored in a -20°C freezer. Following completion of the field sampling campaign, the samples and blanks were transported to Colorado State University, where they were stored in a -20°C freezer prior to PM<sub>2.5</sub> mass measurement and BC analysis.</p>
<p>All filters were placed in an environmentally-controlled equilibration chamber (21-22 °C, 30-34% relative humidity) for at least 24 hours before tare and gross weighing. Before each weight was taken, filters were discharged on a polonium-210 strip for at least 15 seconds. Filters were weighed on a microbalance (Mettler Toledo Inc., XS3DU, USA) with 1-μg resolution in triplicate or more, until the differences among three weights were less than 3 μg. The average of three readings was used to determine filter mass, which was then blank-corrected using the median value of blank filters [3 μg for UPAS-collected filters (53% of samples); 33 μg for PEM-collected filters (47% of filter samples)], and PM2.5 concentrations were calculated by dividing the mass by the sampled air volume.</p>
<p>Filters were analyzed for black carbon (BC) using an optical transmissometer data acquisition system (SootScan^TM OT21 Optical Transmissometer; Magee Scientific, Berkeley, CA, USA). Light attenuation through each filter was measured before and after sampling in the field. To calculate BC mass, the difference between the pre- and post- light attenuation was converted to a mass surface loading using the classical Magee mass absorption cross-sections of 16.6 m2/g for the 880 nm channel optical BC <span class="citation" data-cites="ahmed2009">(<a href="#ref-ahmed2009" role="doc-biblioref">Ahmed et al. 2009</a>)</span>. BC concentrations were calculated by multiplying surface loadings by the sampled surface area of the filters (8.6 cm2 for UPAS-collected filters; 7.1 cm2 for PEM-collected filters), correcting for the field blank mass using the median value of blanks (0.31 μg for UPAS-collected filters; 0.01 μg for PEM-collected filters), and finally dividing by the sampled air volume.</p>
<ul>
<li><p>Health measurements including blood pressure (all), self-reported respiratory symptoms (all), blood inflammatory and oxidative stress markers (~70% in first two campaigns only), grip strength (~75%), and airway inflammation (~20%).</p></li>
<li><p>Field equipment (Figure)</p></li>
</ul>
</section>
</section>
<section id="policy-impacts" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="policy-impacts"><span class="header-section-number">4.3</span> Policy impacts</h2>
<p>To understand how Beijing’s policy works we used a difference-in-differences (DiD) design <span class="citation" data-cites="callaway2020">(<a href="#ref-callaway2020" role="doc-biblioref">Callaway 2020</a>)</span>, leveraging the staggered rollout of the policy across multiple villages to estimate its impact on health outcomes and understand the mechanisms through which it works. Simple comparisons of treated and untreated (i.e., control) villages after the CBHP policy has been implemented are likely to be biased by unmeasured village-level characteristics (e.g., migration, average winter temperature) that are associated with health outcomes. Similarly, comparisons of only treated villages before and after exposure to the program are susceptible to bias by other factors associated with changes in outcomes over time (i.e., secular trends, impacts of the COVID-19 pandemic). By comparing <em>changes</em> in outcomes among treated villages to <em>changes</em> in outcomes among untreated villages, we can control for any unmeasured time-invariant characteristics of villages as well as any general secular trends affecting all villages that are unrelated to the policy</p>
<ul>
<li>DiD schematic (Figure)</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="hei-report_files/figure-html/didfig-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Stylized example of difference-in-differences</figcaption>
</figure>
</div>
</div>
</div>
<p>The DiD design compares outcomes before and after an intervention in a treated group relative to the same outcomes measured in a control group. The control group trend provides the crucial “counterfactual” estimate of what would have happened in the treated group had it not been treated. By comparing each group to itself, this approach helps to control for both measured and unmeasured fixed differences between the treated and control groups. By measuring changes over time in outcomes in the control group unaffected by the treatment, this approach also controls for any unmeasured factors affecting outcome trends in both treated and control groups. This is important since there are often many potential factors affecting outcome trends that cannot be disentangled from the policy if one only studies the treated group (as in a traditional pre-post design).</p>
<p>The canonical DiD design <span class="citation" data-cites="card1994">(<a href="#ref-card1994" role="doc-biblioref">Card and Krueger 1994</a>)</span> compares two groups (treated and control) at two different time periods (pre- and post-intervention, Figure X). In the first time period both groups are untreated, and in the second time period one group is exposed to the intervention. If we assume that the differences between the groups would have remained constant in the absence of the intervention (parallel trends assumption), then an unbiased estimate of the impact of the intervention in the post period can be calculated by subtracting the pre-post difference in the untreated group from the pre-post difference in the treated group.</p>
<p>However, when multiple groups are treated at different time periods, the most common approach has been to use a two-way fixed effects model to estimate the impact of the intervention which controls for secular trends and differences between districts. However, recent evidence suggests that the traditional two-way fixed effects estimation of the treatment effect may be biased in the context of heterogeneous treatment effects <span class="citation" data-cites="callaway2021 goodman-bacon2021">(<a href="#ref-callaway2021" role="doc-biblioref">Callaway and Sant’Anna 2021</a>; <a href="#ref-goodman-bacon2021" role="doc-biblioref">Goodman-Bacon 2021</a>)</span></p>
</section>
<section id="pathways-and-mechanisms" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="pathways-and-mechanisms"><span class="header-section-number">4.4</span> Pathways and mechanisms</h2>
<p>To estimate how much of the CBHP intervention may work through different mechanisms, we used causal mediation analysis. Causal approaches to mediation attempt to discern between, and clarify the necessary assumptions for identifying, different kinds of mediated effects. Taking as an example the DAG in <strong>Figure X</strong>, with <span class="math inline">\(T\)</span> as the policy, <span class="math inline">\(M\)</span> as PM<sub>2.5</sub>, and <span class="math inline">\(Y\)</span> as systolic blood pressure, we can define the controlled direct effect (<span class="math inline">\(CDE\)</span>) as the effect of the CBHP policy on systolic blood pressure if we fix the value of PM<sub>2.5</sub> to a certain reference level for the entire population. For example, we can estimate the impact of the policy on health outcomes while holding PM<sub>2.5</sub> at a uniform level of average background exposure, or some other hypothetical level.</p>
<ul>
<li>Mediation DAG (Figure)</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="hei-report_files/figure-html/dag1-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Example of direct and indirect effects with outcome (<span class="math inline">\(Y\)</span>), treatment (<span class="math inline">\(T\)</span>), and mediator (<span class="math inline">\(M\)</span>)</figcaption>
</figure>
</div>
</div>
</div>
<p>Although other mediated effects such as “natural” direct and indirect effects are theoretically estimable <span class="citation" data-cites="vanderweele2015">(<a href="#ref-vanderweele2015" role="doc-biblioref">VanderWeele 2015</a>)</span>, they involve challenging “cross-world” assumptions that are difficult to anchor in policy <span class="citation" data-cites="naimi2014">(<a href="#ref-naimi2014" role="doc-biblioref">Naimi et al. 2014</a>)</span>. Other approaches to mechanisms have focused on principal stratification <span class="citation" data-cites="zigler2016">(e.g., <a href="#ref-zigler2016" role="doc-biblioref">Zigler et al. 2016</a>)</span>, although conceptual difficulties with identifying the (unverifiable) principal strata make it challenging for questions of mediation. Because controlled direct effects are considered more directly policy relevant for public health, we focus on estimating these mediated quantities.</p>
</section>
</section>
<section id="data-analysis" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Data Analysis</h1>
<section id="total-effect" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="total-effect"><span class="header-section-number">5.1</span> Total Effect</h2>
<p>To estimate the total effect of the policy we used a DiD analysis that accommodates staggered treatment rollout. To allow for heterogeneity in the context of staggered rollout we used ‘extended’ two-way fixed effects (ETWFE) models <span class="citation" data-cites="wooldridge2021">(<a href="#ref-wooldridge2021" role="doc-biblioref">Wooldridge 2021</a>)</span> to estimate the total effect of the CBHP policy. The mean outcome (replaced by a suitable link function <span class="math inline">\(g(\cdot)\)</span> for binary or count outcomes) was defined using a set of linear predictors:</p>
<p><span id="eq-etwfe"><span class="math display">\[Y_{ijt}=g(\mu_{ijt}) = \alpha + \sum_{r=q}^{T} \beta_{r} d_{r} + \sum_{s=r}^{T} \gamma_{s} fs_{t}+ \sum_{r=q}^{T} \sum_{s=r}^{T} \tau_{rt} (d_{r} \times fs_{t}) + \varepsilon_{ijt} \tag{1}\]</span></span></p>
<p>where <span class="math inline">\(Y_{ijt}\)</span> is the outcome for individual <span class="math inline">\(i\)</span> in village <span class="math inline">\(j\)</span> at time <span class="math inline">\(t\)</span>, <span class="math inline">\(d_{r}\)</span> represent treatment cohort dummies, i.e., fixed effects for cohorts of villages that were first exposed to the policy at the same time <span class="math inline">\(q\)</span> (e.g., in 2019, 2020, or 2021), <span class="math inline">\(fs_{t}\)</span> are time fixed effects corresponding to different winter data collection campaigns (2018-19, 2019-20, or 2021-22), and <span class="math inline">\(\tau_{rt}\)</span> are the cohort-time <em>ATTs</em>. The ETWFE and other approaches that allow for several (potentially heterogenous) treatment effects may also be averaged to provide a weighted <span class="math inline">\(ATT\)</span>. Several potential possibilities are feasible, including weighting by treatment cohorts or time since policy adoption <span class="citation" data-cites="goin2023">(<a href="#ref-goin2023" role="doc-biblioref">Goin and Riddell 2023</a>)</span></p>
</section>
<section id="mediation-analysis" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="mediation-analysis"><span class="header-section-number">5.2</span> Mediation Analysis</h2>
<p>As noted above, with respect to the mediation analysis we are chiefly interested in the <span class="math inline">\(CDE\)</span>, which can be derived by adding relevant mediators <span class="math inline">\(M\)</span> to this model. If we also allow for exposure-mediator interaction and potentially allow for adjustment for confounders <span class="math inline">\(W\)</span> of the mediator-outcome effect, we can extend equation <a href="#eq-etwfe">Equation&nbsp;1</a> as follows:</p>
<p><span id="eq-etwfem"><span class="math display">\[
\begin{aligned}
Y_{ijt}=g(\mu_{ijt}) = \alpha + \sum_{r=q}^{T} \beta_{r} d_{r} + \sum_{s=r}^{T} \gamma_{s} fs_{t}+ \sum_{r=q}^{T} \sum_{s=r}^{T} \tau_{rt} (d_{r} \times fs_{t}) \\ + \delta M_{it} + \sum_{r=q}^{T} \sum_{s=r}^{T} \eta_{rt} (d_{r} \times fs_{t} \times M_{it}) + \zeta \mathbf{W} + \varepsilon_{ijt}
\end{aligned}
\tag{2}\]</span></span></p>
<p>where now <span class="math inline">\(\delta\)</span> is the conditional effect of the mediator <span class="math inline">\(M\)</span> at the reference level of the treatment (again, represented via the series of group-time interaction terms), and the collection of <span class="math inline">\(\eta\)</span> terms are coefficients for the product terms allowing for mediator-treatment interaction. Finally, <span class="math inline">\(\zeta\)</span> is a vector of coefficients for the set of confounders contained within <span class="math inline">\(\mathbf{W}\)</span>.</p>
<p>As noted above, in the staggered DiD framework that allows for heterogeneity we do not have a single treatment effect but a collection of group-time treatment effects that may be averaged in different ways. This extends to the estimation of the <span class="math inline">\(CDE\)</span>, in which case we will also have several <span class="math inline">\(CDE\)</span>s that can be averaged to make inferences about the extent to which the policy’s impact is mediated by <em>PM<sub>2.5</sub></em>. Based on the setup in <a href="#eq-etwfem">Equation&nbsp;2</a> the <span class="math inline">\(CDE\)</span> is estimated as: <span class="math inline">\(\delta + \eta_{rt}MT\)</span>. In the absence of interaction between the exposure and the mediator (i.e., <span class="math inline">\(\eta_{rt}=0\)</span>) the <span class="math inline">\(CDE\)</span> will simply be the estimated treatment effects <span class="math inline">\(\sum_{r=q}^{T} \sum_{s=r}^{T} \tau_{rt}\)</span>, i.e., the effect of the policy holding <span class="math inline">\(M\)</span> constant. For a valid estimate of the <span class="math inline">\(CDE\)</span> we must account for confounding of the mediator-outcome effect, represented by <span class="math inline">\(W\)</span> in the equation above. Baseline measures of both the outcome and the proposed mediators inherent in our DiD strategy will help to reduce the potential for unmeasured confounding of the mediator-outcome effect <span class="citation" data-cites="keele2015">(<a href="#ref-keele2015" role="doc-biblioref">Keele et al. 2015</a>)</span>.</p>
</section>
</section>
<section id="results-1" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Results</h1>
<section id="description-of-study-sample-table" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="description-of-study-sample-table"><span class="header-section-number">6.1</span> Description of study sample (Table)</h2>
<ul>
<li>Study flowchart of participants (Figure)</li>
<li>Description of PM measurements (Figure)</li>
<li>Uptake of the policy (Sankey energy use Figure)</li>
<li>Impact of ‘treatment assignment’ on coal use (Figure? Table?)</li>
</ul>
<p>This part of the Results section will focus on the extent of field measurements and survey completeness (good retention), as well as describing the high degree of uptake and adherence to the policy as it was rolled out across villages.</p>
</section>
<section id="aim-1-policy-impacts-and-potential-mediation" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="aim-1-policy-impacts-and-potential-mediation"><span class="header-section-number">6.2</span> Aim 1: Policy impacts and potential mediation</h2>
<ul>
<li>Impact of policy on PM mass (Figure, likely with panels), including personal, indoor, and outdoor.</li>
<li>Table of total effects of the policy as well as <span class="math inline">\(CDE\)</span>s (Central SBP, Central DBP, FeNO, Respiratory outcomes, inflammatory markers), mediated by indoor PM and potentially temperature (<span class="math inline">\(CDE\)</span>s for personal and outdoor perhaps moved to in SI)</li>
<li>Table for multiple mediation analysis for BP</li>
</ul>
</section>
<section id="aim-2-source-contributions" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="aim-2-source-contributions"><span class="header-section-number">6.3</span> Aim 2: Source contributions</h2>
<ul>
<li>Figure of source contributions (6 or fewer components)</li>
<li>Source contributions by treatment status</li>
<li>DiD for source contributions to PM</li>
</ul>
</section>
<section id="aim-3" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="aim-3"><span class="header-section-number">6.4</span> Aim 3</h2>
<ul>
<li>Table of mediated health effects by source contribution (coal and biomass)</li>
</ul>
</section>
</section>
<section id="discussion-and-conclusions" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Discussion and Conclusions</h1>
<ul>
<li>Generally describing high take-up of the policy</li>
<li>Reductions in indoor PM<sub>2.5</sub> but not personal or outdoor</li>
<li>Reduction in blood pressure and self-reported respiratory symptoms</li>
</ul>
<p>Other relevant results (Tables or figures in SI)</p>
<p>Policy impacts on other relevant outcomes:</p>
<ul>
<li>Temperature</li>
<li>Heating room</li>
<li>Well-being</li>
</ul>
</section>
<section id="implications-of-findings" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Implications of Findings</h1>
</section>
<section id="data-availability-statement" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Data Availability Statement</h1>
<ul>
<li>Description of datasets and code available on our project page at the Open Science Foundation</li>
</ul>
</section>
<section id="acknowledgements" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Acknowledgements</h1>
<p>To come…</p>
</section>
<section id="references" class="level1" data-number="11">
<h1 data-number="11"><span class="header-section-number">11</span> References</h1>
<div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-ahmed2009" class="csl-entry" role="listitem">
Ahmed T, Dutkiewicz VA, Shareef A, Tuncel G, Tuncel S, Husain L. 2009. Measurement of black carbon (<span>BC</span>) by an optical method and a thermal-optical method: <span>Intercomparison</span> for four sites. Atmospheric Environment 43:6305–6311; doi:<a href="https://doi.org/10.1016/j.atmosenv.2009.09.031">10.1016/j.atmosenv.2009.09.031</a>.
</div>
<div id="ref-callaway2020" class="csl-entry" role="listitem">
Callaway B. 2020. <a href="https://doi.org/10.1007/978-3-319-57365-6_352-1">Difference-in-<span>Differences</span> for <span>Policy Evaluation</span></a>. In: <em>Handbook of <span>Labor</span>, <span>Human Resources</span> and <span>Population Economics</span></em> (K.F. Zimmermann, ed). <span>Springer International Publishing</span>:<span>Cham</span>. 1–61.
</div>
<div id="ref-callaway2021" class="csl-entry" role="listitem">
Callaway B, Sant’Anna PHC. 2021. Difference-in-<span>Differences</span> with multiple time periods. Journal of Econometrics 225:200–230; doi:<a href="https://doi.org/10.1016/j.jeconom.2020.12.001">10.1016/j.jeconom.2020.12.001</a>.
</div>
<div id="ref-card1994" class="csl-entry" role="listitem">
Card D, Krueger AB. 1994. Minimum <span>Wages</span> and <span>Employment</span>: <span>A Case Study</span> of the <span>Fast-Food Industry</span> in <span>New Jersey</span> and <span>Pennsylvania</span>. American Economic Review 84: 772–93.
</div>
<div id="ref-goin2023" class="csl-entry" role="listitem">
Goin DE, Riddell CA. 2023. Comparing <span class="nocase">Two-way Fixed Effects</span> and <span>New Estimators</span> for <span class="nocase">Difference-in-Differences</span>: <span>A Simulation Study</span> and <span>Empirical Example</span>. Epidemiology 34:535; doi:<a href="https://doi.org/10.1097/EDE.0000000000001611">10.1097/EDE.0000000000001611</a>.
</div>
<div id="ref-goodman-bacon2021" class="csl-entry" role="listitem">
Goodman-Bacon A. 2021. Difference-in-differences with variation in treatment timing. Journal of Econometrics 225:254–277; doi:<a href="https://doi.org/10.1016/j.jeconom.2021.03.014">10.1016/j.jeconom.2021.03.014</a>.
</div>
<div id="ref-keele2015" class="csl-entry" role="listitem">
Keele L, Tingley D, Yamamoto T. 2015. Identifying mechanisms behind policy interventions via causal mediation analysis. Journal of Policy Analysis and Management 34: 937–963.
</div>
<div id="ref-li2022" class="csl-entry" role="listitem">
Li X, Baumgartner J, Barrington-Leigh C, Harper S, Robinson B, Shen G, et al. 2022. Socioeconomic and <span>Demographic Associations</span> with <span>Wintertime Air Pollution Exposures</span> at <span>Household</span>, <span>Community</span>, and <span>District Scales</span> in <span>Rural Beijing</span>, <span>China</span>. Environmental Science &amp; Technology 56:8308–8318; doi:<a href="https://doi.org/10.1021/acs.est.1c07402">10.1021/acs.est.1c07402</a>.
</div>
<div id="ref-naimi2014" class="csl-entry" role="listitem">
Naimi AI, Kaufman JS, MacLehose RF. 2014. Mediation misgivings: Ambiguous clinical and public health interpretations of natural direct and indirect effects. International journal of epidemiology 43:1656–61; doi:<a href="https://doi.org/10.1093/ije/dyu107">10.1093/ije/dyu107</a>.
</div>
<div id="ref-vanderweele2015" class="csl-entry" role="listitem">
VanderWeele TJ. 2015. <em>Explanation in causal inference: Methods for mediation and interaction</em>. <span>Oxford University Press</span>:<span>New York</span>.
</div>
<div id="ref-volckens2017" class="csl-entry" role="listitem">
Volckens J, Quinn C, Leith D, Mehaffy J, Henry CS, Miller-Lionberg D. 2017. Development and evaluation of an ultrasonic personal aerosol sampler. Indoor air 27:409–416; doi:<a href="https://doi.org/10.1111/ina.12318">10.1111/ina.12318</a>.
</div>
<div id="ref-wooldridge2021" class="csl-entry" role="listitem">
Wooldridge JM. 2021. Two-<span>Way Fixed Effects</span>, the <span>Two-Way Mundlak Regression</span>, and <span class="nocase">Difference-in-Differences Estimators</span>.; doi:<a href="https://doi.org/10.2139/ssrn.3906345">10.2139/ssrn.3906345</a>.
</div>
<div id="ref-woolley2022" class="csl-entry" role="listitem">
Woolley KE, Dickinson-Craig E, Lawson HL, Sheikh J, Day R, Pope FD, et al. 2022. Effectiveness of interventions to reduce household air pollution from solid biomass fuels and improve maternal and child health outcomes in low- and middle-income countries: <span>A</span> systematic review and meta-analysis. Indoor Air 32:e12958; doi:<a href="https://doi.org/10.1111/ina.12958">10.1111/ina.12958</a>.
</div>
<div id="ref-zigler2016" class="csl-entry" role="listitem">
Zigler CM, Kim C, Choirat C, Hansen JB, Wang Y, Hund L, et al. 2016. <em>Causal inference methods for estimating long-term health effects of air quality regulations. <span>Research</span> report 187.</em> <span>Health Effects Institute / Health Effects Institute</span>:<span>Boston, MA</span>.
</div>
</div>
</section>
<section id="appendices" class="level1 unnumbered">
<h1 class="unnumbered">Appendices</h1>
</section>
<section id="about-the-authors" class="level1 unnumbered">
<h1 class="unnumbered">About the authors</h1>
</section>
<section id="other-publications" class="level1 unnumbered">
<h1 class="unnumbered">Other publications</h1>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>SH: Taken from Appendix from <span class="citation" data-cites="li2022">(<a href="#ref-li2022" role="doc-biblioref">Li et al. 2022</a>)</span>, needs to be re-written<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>